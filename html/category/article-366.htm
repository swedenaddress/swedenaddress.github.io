<!doctype html>
<html lang="zh-CN">

<head>
    <!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="canonical" href="https://swedenaddress.github.io/html/category/article-366.htm" />
<link rel="icon" href="/assets/addons/xcblog/img/swedenaddress/favicon.ico" type="image/x-icon"/>
<title>react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具 - SwedenAddress</title>
<link rel="stylesheet" href="/assets/addons/xcblog/css/swedenaddress/style-starter.css">
<link href="https://fonts.googleapis.com/css?family=Josefin+Slab:400,700,700i&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ff0c66a832e6568df61664f01ded8b73";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body id="home">
    <section class=" w3l-header-4 header-sticky">
    <header class="absolute-top">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light">
                                <a class="navbar-brand" href="/">
                        Sweden Address
                    </a>
                                <button class="navbar-toggler bg-gradient collapsed" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="fa icon-expand fa-bars"></span>
                    <span class="fa icon-close fa-times"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                                                <li class="nav-item">
                            <a class="nav-link" href="/">首页</a>
                        </li>
                                                <li class="nav-item">
                            <a class="nav-link" href="/html/category/">文章分类</a>
                        </li>
                                                <li class="nav-item">
                            <a class="nav-link" href="#">关于</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">联系</a>
                        </li>
                    </ul>
                </div>
        </div>
        </nav>
        </div>
    </header>
</section>
<script src="/assets/addons/xcblog/js/frontend/swedenaddress/jquery-3.3.1.min.js"></script> <!-- Common jquery plugin -->
<!--bootstrap working-->
<script src="/assets/addons/xcblog/js/frontend/swedenaddress/bootstrap.min.js"></script>
<!-- //bootstrap working-->
<!-- disable body scroll which navbar is in active -->
<script>
$(function() {
    $('.navbar-toggler').click(function() {
        $('body').toggleClass('noscroll');
    })
});
</script>
    <!-- breadcrumbs -->
    <section class="w3l-inner-banner-main">
        <div class="about-inner about ">
            <div class="container">
                <div class="main-titles-head text-center">
                    <h1 class="header-name" style="word-break: break-all;">
                        react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具                    </h1>
                    
                </div>
            </div>
        </div>
        <div class="breadcrumbs-sub">
            <div class="container">
                <ul class="breadcrumbs-custom-path">
                    <li class="right-side propClone"><a href="/" class="">首页 <span class="fa fa-angle-right" aria-hidden="true"></span></a>
                        <p>
                    </li>
                    <li class="right-side propClone"><a href="/html/category/" class="">文章分类 <span class="fa fa-angle-right" aria-hidden="true"></span></a>
                        <p>
                    </li>
                    <li class="active ">正文</li>
                </ul>
            </div>
        </div>
        </div>
    </section>
    <!-- breadcrumbs //-->
    <section class="w3l-content-with-photo-4" id="about">
        <div class="content-with-photo4-block ">
            <div class="container">
                <div class="row">
                    <div class="col-md-9">
                          				  				  				<blockquote> <p>其他章节请看：</p> <p>react实战 系列</p> </blockquote> <h2 id="my-dashboard">My Dashboard</h2> <p>上一篇我们在 spug 项目中模仿”任务计划“模块实现一个类似的一级导航页面（”My任务计划“），本篇，我们将模仿“Dashboard”来实现一个仪表盘“My Dashboard”。</p> <p>主要涉及 antd 的<code>Grid</code>、<code>Card</code>、<code>Descriptions</code>等组件、<code>bizcharts</code> 的使用、<code>moment</code> 日期库和页面适配。</p> <p><em>注</em>：实现的代码在上一篇的基础上展开。</p> <h3 id="dashboard">Dashboard</h3> <p>界面如下：<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/643bd77e44ac6216ffd895897aa7af4a.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>里面用到了：</p> <ul> <li>antd 的<code>Grid</code>、<code>Card</code>、<code>Descriptions</code> 描述列表 （文字长度不同，有时会感觉没对齐）</li> <li><code>bizcharts</code> 中的折线图、柱状图</li> <li><code>moment</code>（日期相关的库），比如按天、按月、最近 30 天都很方便</li> </ul> <h3 id="my-dashboard-1">My Dashboard</h3> <h4 id="最终效果">最终效果</h4> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/a0220015247287882706f5e06ce95531.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>无需权限即可访问：<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/e9354f6a879ae7bce2c727233218b192.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>全屏效果：<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/90ab6d0e13b0a2fb43c773f5b5a87598.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <h3 id="实现的代码">实现的代码</h3> <h4 id="安装两个依赖包">安装两个依赖包：</h4> <ul> <li><code>@antv/data-set</code>，柱状图和饼状图需要使用</li> <li><code>bx-tooltip</code>，自定义 bizcharts 中的 tooltip。折线图和柱状图的 tooltip 都使用了。</li> </ul> <pre><code class="language-javascript">spug-study> npm i @antv/data-set  added 31 packages, and audited 1820 packages in 26s  107 packages are looking for funding   run `npm fund` for details  33 vulnerabilities (1 low, 16 moderate, 15 high, 1 critical)  To address issues that do not require attention, run:          npm audit fix  To address all issues (including breaking changes), run:       npm audit fix --force  Run `npm audit` for details.</code></pre> <pre><code class="language-javascript">spug-study> npm i -D bx-tooltip  added 1 package, and audited 1821 packages in 9s  107 packages are looking for funding   run `npm fund` for details  33 vulnerabilities (1 low, 16 moderate, 15 high, 1 critical)  To address issues that do not require attention, run:   npm audit fix  To address all issues (including breaking changes), run:   npm audit fix --force  Run `npm audit` for details.</code></pre> <p>package.json 变动如下：</p> <pre><code class="language-javascript">"dependencies": {   "@antv/data-set": "^0.11.8", } "devDependencies": {   "bx-tooltip": "^0.1.6", }</code></pre> <h4 id="增强表格组件">增强表格组件</h4> <p>spug 中封装的表格组件，不支持 style和 size。替换一行，以及增加一行：</p> <pre><code class="language-javascript">// src/components/TableCard.js  - <div ref={rootRef} className={styles.tableCard}> + <div ref={rootRef} className={styles.tableCard} style={{...props.customStyles}}>  <Table + size={props.size}</code></pre> <h4 id="准备-mock-数据">准备 mock 数据</h4> <p>将 mydashboard 模块的的 mock 专门放入一个文件，并在<code>mock/index.js</code> 中引入。</p> <pre><code class="language-javascript">// src\mock\index.js  + import './mydashboard'</code></pre> <pre><code class="language-javascript">// src\mock\mydashboard.js  import Mock from 'mockjs'  // 开发环境引入 mock if (process.env.NODE_ENV === 'development') {      Mock.mock('/api/mdashboard/occupancy_rate/', 'get', () => (     {"data": [ {         month: "2022-01-01",         city: "城市-名字很长很长很长",         happiness: 10,         per: 90,         msg1: '信息xxx'     },     {         month: "2022-01-01",         city: "城市B",         per: 30,         happiness: 50,         msg1: '信息xxx'     },     {         month: "2022-02-01",         city: "城市-名字很长很长很长",         happiness: 20,         per: 40,         msg1: '信息xxx'     },          {         month: "2022-02-01",         city: "城市B",         happiness: 20,         per: 60,         msg1: '信息xxx'     },     {         month: "2022-03-01",         city: "城市-名字很长很长很长",         happiness: 30,         per: 80,         msg1: '信息xxx'     },], "error": ""}  ))  let mIdSeed = 1; Mock.mock('/api/mdashboard/table', 'get', () => ({     "data": [{ "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() },     { "id": mIdSeed++, "name": "苹果" + mIdSeed, address: '场地' +mIdSeed, time: new Date().toLocaleTimeString() }, ] })) }</code></pre> <h4 id="路由配置">路由配置</h4> <p>配置<code>/mdashboard</code> 和<code>/mydashboard</code> 两个路由：</p> <pre><code class="language-javascript">// src\App.js  + import MDashboard from './pages/mdashboard/tIndex';  class App extends Component {   render() {     return (       <Switch>       //  无需权限       + <Route path="/mdashboard" exact component={MDashboard} />         <Route path="/" exact component={Login} />         <Route path="/ssh" exact component={WebSSH} />         <Route component={Layout} />       </Switch>     );   } }</code></pre> <pre><code class="language-javascript">// src\routes.js  + import MyDashboardIndex from './pages/mdashboard';  export default [   {icon: <DesktopOutlined/>, title: '工作台', path: '/home', component: HomeIndex},   {     icon: <DashboardOutlined/>,     title: 'Dashboard',     auth: 'dashboard.dashboard.view',     path: '/dashboard',     component: DashboardIndex   }, + // 我的仪表盘 + { +   icon: <DashboardOutlined />, +   title: 'MyDashboard', +   auth: 'mydashboard.mydashboard.view', +   path: '/mydashboard', +   component: MyDashboardIndex + },</code></pre> <p>新建仪表盘组件。一个需要权限访问，另一个无需权限即可访问，故将仪表盘提取成一个单独的文件：</p> <pre><code class="language-javascript">// src\pages\mdashboard\Dashboard.js  import React from 'react'; export default function () {   return (     <div>仪表盘</div>   ) }</code></pre> <pre><code class="language-javascript">// src\pages\mdashboard\index.js  import React from 'react'; import { AuthDiv } from 'components'; import Dashboard from './Dashboard';  export default function () {   return (     <section>       //  AuthDiv 是 spug 封装的与权限相关的组件                <p>需要权限才能访问</p>         <Dashboard />       </AuthDiv>     </section>   ) }</code></pre> <pre><code class="language-javascript">// src\pages\mdashboard\tIndex.js  import React from 'react'; import Dashboard from './Dashboard';  export default function () {   return (     <section>         <p>无需权限也能访问</p>         <Dashboard />     </section>   ) }</code></pre> <p>重启服务，倘若能访问，说明一切就绪，只差仪表盘核心代码。</p> <p>访问<code>/mydashboard</code>：<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/a1216f1e8026df034ac5b56482c6e484.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>访问<code>/mdashboard</code>：<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/25f629cad863c818646d0c282e35273a.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <h4 id="仪表盘的核心代码">仪表盘的核心代码</h4> <h5 id="样式">样式</h5> <pre><code class="language-javascript">// src\pages\mdashboard\index.module.less  .tdashboardBox {     .react{         width: 10px;         height: 10px;         display: inline-block;         background: #52c41a; /* #00000040 */         margin-left: 30px;         margin-right: 10px;     }      // 参考：src\components\index.module.less 中 global     :global(.trendBox .ant-card-head-wrapper) {         width: 100%;     } }</code></pre> <h5 id="表格水果信息">表格（水果信息）</h5> <pre><code class="language-javascript">// src\pages\mdashboard\Table.js  import React from 'react'; import { observer } from 'mobx-react'; import { Descriptions } from 'antd'; import { TableCard } from 'components'; import store from './store';  @observer class ComTable extends React.Component {   // 默认值   static defaultProps = {     tableHeight: 353   }    // scrollY 以外的高度   excludeScrollY = 120;   componentDidMount() {     store.fetchRecords()   }    columns = [{     title: 'id',     dataIndex: 'id',   },{     title: '名称',     dataIndex: 'name',   }, {     title: '生产地',     dataIndex: 'address',   }, {     title: '时间',     dataIndex: 'time',   }];    handleExpand = record => {     return <Descriptions>       <Descriptions.Item label="真数据">{record.time}</Descriptions.Item>       <Descriptions.Item label="假数据">xxx</Descriptions.Item>       <Descriptions.Item label="假数据xxx">xxxxxx</Descriptions.Item>       <Descriptions.Item label="假数据xx">xxxxxxxxxxxxxxx</Descriptions.Item>       <Descriptions.Item label="假数据xx">xxx</Descriptions.Item>       <Descriptions.Item label="假数据xxxxxx">         xxxxx xxxxx xxxxxxxxxx xxxxxxxxx       </Descriptions.Item>     </Descriptions>   }    render() {     console.log('this.props.tableHeight', this.props.tableHeight, 'y', this.props.tableHeight * this.scrollRadio)     return (       <TableCard       customStyles={{height: this.props.tableHeight}}         title="水果信息"         tKey="mt"         rowKey="id"         loading={store.isFetching}         dataSource={store.dataSource}         onReload={store.fetchRecords}         actions={[]}         scroll={{ y: this.props.tableHeight  - this.excludeScrollY  }}         expandable={{           expandedRowRender: this.handleExpand,           expandRowByClick: true         }}         size={'middle'}         // 设为 false 时不展示和进行分页         pagination={false}         columns={this.columns} />     )   } }  export default ComTable</code></pre> <h5 id="折线图居住趋势">折线图（居住趋势）</h5> <pre><code class="language-javascript">// src\pages\mdashboard\Trend.js  import React, { useState, useEffect } from 'react'; import { Card, DatePicker, Modal } from 'antd'; import { Chart, Geom, Axis, Tooltip, Legend } from 'bizcharts'; import { http } from 'libs'; import styles from './index.module.less' // 日期相关的库，比如最近30天等 import moment from 'moment';  /* bizcharts 官网： 通过bx-tooltip插件自定义  为了满足更灵活多变的Tooltip自定义需求，提供bx-tooltip插件来实现ReactNode渲染，摆脱HTML模板的繁琐和死板 */ import useCustTooltip from 'bx-tooltip'; import { Typography, Space } from 'antd'; import store from './store'  export default function (props = { cardBodyHeight: 450 }) {   // chart 高度占比   const chartHeightRatio = 0.888    const { Text, Link, Title } = Typography;   const [loading, setLoading] = useState(true);   // 本月第一天 —— 本月最后一天   // const [duration, setDuration] = useState([moment().startOf('month'), moment().endOf('month')]);   // 最近三十天   const [duration, setDuration] = useState([moment().subtract(29, 'days'), moment()]);   const [res, setRes] = useState([]);    useEffect(() => {     const strDuration = duration.map(x => x.format('YYYY-MM-DD'))      setLoading(true);     http.get('/api/mdashboard/occupancy_rate/', { duration: strDuration })       .then(res => {         setRes(res)       })       .finally(() => setLoading(false))   }, [duration])    // bx-tooltip插件的使用   const [BxChart, CustTooltip] = useCustTooltip.create(Chart, Tooltip);    return (     // headStyle、bodyStyle 在这里都是用于适配（响应式）     <Card className="trendBox" loading={loading} title="居住趋势" headStyle={store.cardTitleStyle} bodyStyle={{ height: props.cardBodyHeight }} extra={(       <div>         <DatePicker.RangePicker allowClear={false} style={{ width: 250 }} value={duration} onChange={val => setDuration(val)} />       </div>     )}>        <BxChart height={props.cardBodyHeight * chartHeightRatio} data={res} padding={[30, 120, 20, 60]}         // 坐标轴展示不完整         scale={{ month: { range: [0.05, 0.99] }, per: { alias: '居住率', range: [0, 0.95], minTickInterval: 10, max: 100, min: 0 } }}         // 强制适应（PS：只会对宽度有响应式，高度没有）         forceFit       >         <Legend position="right-center" allowAllCanceled={true} itemFormatter={val => {           const maxNum = 10           return val.length > maxNum ? val.split('').slice(0, maxNum - 3).join('') + '...' : val         }} />         {/* x 坐标格式化 */}         <Axis name="month" label={{           formatter(text, item, index) {             // 格式化：2022-01-01 -> 0101             return `${text.split('-').slice(1).join('')}`;           }         }} />          <Axis name="per" title />          {/* 自定义 tooltip */}         <CustTooltip enterable >           {(title, items) => {             return <div>               {                 items.map((x, i) => {                   let oData = x.point._origin                   return <div>                     {Object.is(i, 0) && <Title level={5}>{oData.month}</Title>}                     <section style={{ marginTop: '20px' }}>                       <Title style={{ color: x.color, fontWeight: 'bold' }} level={5}>{oData.city}</Title>                       <Space direction="vertical" size={2}>                         <Text>幸福指数：{oData.happiness}</Text>                         <Link href="hello" target="_blank">                           跳转                         </Link>                         <Link onClick={() => {                           Modal.info({                             title: 'title',                             content: oData.msg1                           });                         }}>                           详情                         </Link>                       </Space>                     </section>                   </div>                 })               }             </div>           }}         </CustTooltip>          <Geom type="line" position="month*per"           // 两条线           size={2}           // 使线条平滑           // shape={"smooth"}            color={"city"}         />       </BxChart>     </Card>   ) }</code></pre> <h5 id="饼状图统计苹果和梨子">饼状图（统计苹果和梨子）</h5> <pre><code class="language-javascript">// src\pages\mdashboard\PieChart.js  import React from 'react'; import { Typography} from 'antd'; import {     Chart,     Geom,     Axis,     Tooltip,     Coord,     Label,     Legend } from 'bizcharts'; import DataSet from '@antv/data-set';  // chartHeight 默认高度 250px ，用于适配 export default function (props = {chartHeight: 250}) {     const { Text } = Typography;      const { DataView } = DataSet;     const data = [         {             item: '苹果',             count: 10,         },         {             item: '梨子',             count: 20,         },     ];     const dv = new DataView();     dv.source(data).transform({         type: 'percent',         field: 'count',         dimension: 'item',         as: 'percent',     });     const cols = {         percent: {             formatter: val => {                 val = val * 100 + '%';                 return val;             },         },     };     function getXY(c, { index: idx = 0, field = 'percent', radius = 0.5 }) {         const d = c.get('data');         if (idx > d.length) return;         const scales = c.get('scales');         let sum = 0;         for (let i = 0; i < idx + 1; i++) {             let val = d[i][field];             if (i === idx) {                 val = val / 2;             }             sum += val;         }         const pt = {             y: scales[field].scale(sum),             x: radius,         };         const coord = c.get('coord');         let xy = coord.convert(pt);         return xy;     }     return (         <section>             <Text>统计苹果和梨子</Text>             <Chart                 height={props.chartHeight}                 // 内容显示不完整（见 bizcharts 实战部分）                 padding={[20, 150, 20, 40]}                 data={dv}                 scale={cols}                 forceFit                 onGetG2Instance={c => {                     const xy = getXY(c, { index: 0 });                     c.showTooltip(xy);                 }}             >                 <Legend position="right-center" />                 <Coord type="theta" radius={1} />                 <Axis name="percent" />                 <Tooltip                     showTitle={false}                     itemTpl='<li><span style="background-color:{color};" class="g2-tooltip-marker"></span>{name}: {value}</li>'                 />                 <Geom                     type="intervalStack"                     position="percent"                     color="item"                     tooltip={[                         'item*percent',                         (item, percent) => {                             // 处理 33.33333333% -> 33.33                             percent = (percent * 100).toFixed(2) + '%';                             return {                                 name: item,                                 value: percent,                             };                         },                     ]}                     style={{                         lineWidth: 1,                         stroke: '#fff',                     }}                 >                     <Label                         content="count"                         formatter={(val, item) => {                             return item.point.item + ': ' + val;                         }}                     />                 </Geom>             </Chart>         </section>     ); }</code></pre> <h5 id="柱状图堆叠柱状图">柱状图（堆叠柱状图）</h5> <pre><code class="language-javascript">// src\pages\mdashboard\BarChart.js  import React from "react"; import { Typography, Space } from 'antd' import {   Chart,   Geom,   Axis,   Tooltip,   Coord,   Legend, } from "bizcharts"; import useCustTooltip from 'bx-tooltip'; import DataSet from "@antv/data-set";  export default function (props = {barHeight: 240}) {   const [BxChart, CustTooltip] = useCustTooltip.create(Chart, Tooltip);   const { Text,Title } = Typography;   const retains = ["State", '总比例', 'bad', 'good', 'Total']   const fields = ["好的比例", "坏的比例"]   const data = [     {       State: "苹果（红富士、糖心苹果）",       good: 50,       bad: 150,       Total: 200,       好的比例: 25,       坏的比例: 75,       总比例: 100     },     {       State: "梨子（香梨）",       good: 75,       bad: 125,       Total: 200,       好的比例: 37.5,       坏的比例: 62.5,       总比例: 100     },   ];    const ds = new DataSet();   const dv = ds.createView().source(data);    dv.transform({     type: "fold",     fields: fields,     key: "比例",     value: "百分总计",     retains: retains // 保留字段集，默认为除fields以外的所有字段   });    return (     <section>       <Text>堆叠柱状图</Text>       <BxChart height={props.barHeight} data={dv} padding={[30, 80, 20, 40]} forceFit>         <Legend position="right-center" />         <Coord />         <Axis           name="State"           label={{             offset: 12,             formatter(text, item, index) {               // 最多显示 10 个，多余省略。详细的在 tooltip 中显示               const maxNum = 10               return text.length > maxNum ? text.split('').slice(0, maxNum - 3).join('') + '...' : text             }           }}         />         <CustTooltip enterable >           {(title, items) => {             return <div>               {                 items.map((x, i) => {                   // 取得原始数据                   let oData = x.point._origin                   return <div>                     {Object.is(i, 0) && <Title level={5}>{oData.State}</Title>}                     <section style={{ marginTop: '20px' }}>                       <Space direction="vertical" size={2}>                         <Text style={{ color: x.color, fontWeight: 'bold' }}>{oData['比例']}：{oData['百分总计']}%</Text>                         <Text>good数量：{oData['good']}</Text>                         <Text>bad数量：{oData['bad']}</Text>                         <Text>总数量：{oData['Total']}</Text>                       </Space>                     </section>                   </div>                 })               }             </div>           }}         </CustTooltip>         <Geom           type="intervalStack"           position="State*百分总计"           color={"比例"}         >         </Geom>       </BxChart>     </section>   ); }</code></pre> <h5 id="storejs">store.js</h5> <pre><code class="language-javascript">// src\pages\mdashboard\store.js  import { observable, computed } from 'mobx'; import http from 'libs/http';  const PADDING = 16 class Store {   // 表格数据   @observable records = [];    // 是否正在请求数据   @observable isFetching = false;    // 数据源   @computed get dataSource() {     return this.records   }    fetchRecords = () => {     this.isFetching = true;     http.get('/api/mdashboard/table')       // todo 接口格式或许会调整        .then(res => this.records = res)       .finally(() => this.isFetching = false)   };    /* 适配相关 */   // 盒子高度，padding 用于给顶部和底部留点空隙。   // 由于笔者没有设计，所以先用 px 实现，之后在在将固定高度改为响应式，937 是固定高度实现后测量出的高度。   @observable baseBoxHeight = 937 - PADDING   @observable padding = PADDING   // 需要用 this 调用 padding 变量，即 `this.padding`   @observable boxHeight = window.innerHeight - this.padding * 2    // 饼图高度比例   @observable pieBoxRatio = 0.20    // 柱状图高度比例   @observable barBoxRatio = 0.23    // “My Dashboard 我的仪表盘”    @computed get TitleHeight() {     const ratio = 80 / this.baseBoxHeight     return this.boxHeight * ratio   }   // 运行card高度   @computed get todayCardHeight() {     const ratio = 75 / this.baseBoxHeight     return this.boxHeight * ratio   }    // “饼图+描述列表+柱状图” body 高度   @computed get statisticBodyHeight() {     const ratio = 660 / this.baseBoxHeight     return this.boxHeight * ratio   }    // 居住趋势 body 的   @computed get trendBodyBodyHeight() {     const ratio = 385 / this.baseBoxHeight     return this.boxHeight * ratio   }    // 水果信息高度   @computed get configTableHeight() {     const ratio = 353 / this.baseBoxHeight     return this.boxHeight * ratio   }    // xys16 得用 computed 才会联动。下面这种写法不会联动   // @observable xys16 = (16 / this.baseBoxHeight) * this.boxHeight   @computed get xys16() {     return (16 / this.baseBoxHeight) * this.boxHeight   }    @computed get xys12() {     return (12 / this.baseBoxHeight) * this.boxHeight   }    @computed get xys36() {     return (36 / this.baseBoxHeight) * this.boxHeight   }    @computed get xys24() {     return (24 / this.baseBoxHeight) * this.boxHeight   }    @computed get xys78() {     return (78 / this.baseBoxHeight) * this.boxHeight   }    @computed get pieBoxHeight() {     return this.pieBoxRatio * this.boxHeight   }    @computed get barBoxHeight() {     return this.barBoxRatio * this.boxHeight   }    // card 的 header    @computed get cardTitleStyle() {     const cardTitleRatio = 57 / this.baseBoxHeight     return { display: 'flex', height: this.boxHeight * cardTitleRatio, alignItems: 'center', justifyContent: 'center' }   }   /* /适配相关 */ }  export default new Store()</code></pre> <h5 id="dashboardjs">Dashboard.js</h5> <pre><code class="language-javascript">// src\pages\mdashboard\Dashboard.js   import React, {useEffect, Fragment} from 'react'; import { Row, Col, Card, Descriptions, Typography, Divider } from 'antd'; import AlarmTrend from './Trend'; import Piechart from './PieChart' import CusTable from './Table'; import CusBarChart from './BarChart'; import Styles from './index.module.less' import { observer } from 'mobx-react'; import store from './store'  export default observer(function () {   // Typography排版   const { Text } = Typography;    useEffect(() => {     // 响应式     window.addEventListener("resize", function(){       // padding，用于留点间距出来       store.boxHeight = window.innerHeight - store.padding * 2     }, false);   }, [])    return (     // Fragment 用于包裹多个元素，却不会被渲染到 dom     <Fragment>       {/* 使用单一的一组 Row 和 Col 栅格组件，就可以创建一个基本的栅格系统，所有列（Col）必须放在 Row 内。 */}       <Row style={{ marginBottom: store.xys16 }}>         <Col span={24}>           {/* 可以省略 px */}           {/* 如果将字体和padding 改为响应式，height 设置或不设置还是有差别的，设置 height 会更准确 */}           <Card bodyStyle={{display: 'flex', height: store.TitleHeight, justifyContent: 'center', padding: store.xys12, fontSize: store.xys36, fontWeight: 700,  }}>             <Text>My Dashboard 我的仪表盘</Text>           </Card>         </Col>       </Row>       <Row gutter={16}>         <Col span={8}>           {/* gutter：水平垂直间距都是 响应式 16  */}           <Row gutter={[store.xys16, store.xys16]}>             {/* 24 栅格系统。 */}             <Col span={24}>               {/* 垂直居中 */}               <Card bodyStyle={{ display: 'flex', height: store.todayCardHeight, alignItems: 'center'}}>                 {/* 文字大小 */}                 <span>                 <Text style={{ fontSize: store.xys16}}>                   运行为绿色，否则为灰色：                   <span className={Styles.react}></span>                   <span>运行</span>                 </Text>                 </span>               </Card>             </Col>             <Col span={24}>               <Card title="饼图+描述列表+柱状图" headStyle={store.cardTitleStyle} bodyStyle={{height: store.statisticBodyHeight}}>                 <Piechart chartHeight={store.pieBoxHeight}/>                 <Divider style={{margin: `${store.xys12}px 0`}}/>                 {/* Descriptions描述列表，常见于详情页的信息展示。这里总是显示两列。 */}                 {/* spug 中“Dashboard”的“最近30天登录”是用的就是Descriptions，缺点是不像 table 对齐。当文字长度不同，会看起来错乱。 */}                 {/* 样式，用于适配，即垂直居中 */}                 <Descriptions column={2} style={{display: 'flex', alignItems: 'center', minHeight: store.xys78}}>                   <Descriptions.Item label="Descriptions">描述列表</Descriptions.Item>                   <Descriptions.Item label="梨子">5个</Descriptions.Item>                   <Descriptions.Item label="购买时间">2022-04-21</Descriptions.Item>                   <Descriptions.Item label="购买途径">                     <Text                       style={{ width: 100 }}                       ellipsis={{ tooltip: '看不完整就将鼠标移上来' }}>                       看不完整就将鼠标移上来                       {/* 超A、超B、超C、超D， */}                     </Text>                   </Descriptions.Item>                 </Descriptions>                 <Divider style={{margin: `${store.xys12}px 0`}}/>                 <CusBarChart barHeight={store.barBoxHeight}/>               </Card>             </Col>           </Row>         </Col>         <Col span={16} >           <Row gutter={[store.xys16, store.xys16]}>             <Col span={24}>               <AlarmTrend cardBodyHeight={store.trendBodyBodyHeight}/>             </Col>             <Col span={24}>               <CusTable tableHeight={store.configTableHeight}/>             </Col>           </Row>         </Col>       </Row>     </Fragment>   ) })</code></pre> <h5 id="indexjs">index.js</h5> <pre><code class="language-javascript">// src\pages\mdashboard\index.js  import React from 'react'; import { AuthDiv } from 'components'; import Dashboard from './Dashboard'; import styles from './index.module.less'  export default function () {   return (     <section className={styles.tdashboardBox}>       <AuthDiv auth="testdashboard.testdashboard.view">         <Dashboard />       </AuthDiv>     </section>   ) }</code></pre> <h5 id="tindexjs">tIndex.js</h5> <pre><code class="language-javascript">// src\pages\mdashboard\tIndex.js  // 无需权限即可访问  import React from 'react'; import Dashboard from './Dashboard'; import store from './store'; import styles from './index.module.less'  export default function () {   return (     <section className={styles.tdashboardBox} style={{padding: `${store.padding}px 16px`, backgroundColor: 'rgb(125 164 222)', height: '100vh'}}>       <Dashboard/>     </section>   ) }</code></pre> <p>重启服务，效果如下：</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/90ab6d0e13b0a2fb43c773f5b5a87598.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <h3 id="bizcharts">bizcharts</h3> <p><a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://bizcharts.taobao.com/"  title="bizcharts" target="_blank" rel="nofollow">bizcharts 是阿里的一个图表组件库。</p> <p><em>注</em>：spug 项目中使用的版本是<code>3.x</code>。参考文档时不要搞错。</p> <h4 id="api文档">API文档</h4> <p>上面我们安装的其中一个依赖包<code>bx-tooltip</code> 就来自这里。</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/30cee81cc6f0fdd042fc82673690e171.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <h4 id="实战">实战</h4> <p>实战其实就是一些 bizcharts 使用上的一些<code>答疑</code>。例如“内容显示不完整”，有可能就是因为 padding 的原因。</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/2075d9dbbee962126831fb5b095c24a9.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <h4 id="图表示例">图表示例</h4> <p>例如我们使用的<code>堆叠柱状图</code>的用法示例就参考这里：</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/d7f3c5f3be0e4da48737c6a9a1c2504e.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>点击进入示例，修改左边源码，右侧显示也会<strong>同步</strong>，非常方便我们在线研究和学习：<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/995e03630124e17e6def4cc1e10266e0.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <h3 id="高度自适应">高度自适应</h3> <p>bizcharts 有宽度自适应，但没有实现高度的自适应。<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/6040cf1c15d2cb3f7f14030667b0ff25.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>笔者高度自适应的做法：将高度全部改为百分比。<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/f995337b259483443fed1075d7993cdb.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>具体做法如下：</p> <ol> <li>由于没有设计，故先用固定像素实现界面</li> <li>取得浏览器的窗口高度 window.innerHeight，笔者这里是 937</li> <li>将“标签盒子”、“卡片头部高度”、卡片 body 部分等全部改为百分比</li> </ol> <p>核心代码如下：</p> <pre><code class="language-javascript">// src\pages\mdashboard\store.js  const PADDING = 16 class Store {    @observable baseBoxHeight = 937 - PADDING    @observable padding = PADDING    // 仪表盘盒子高度   @observable boxHeight = window.innerHeight - this.padding * 2    // 饼图高度比例。根据之前的效果算出来的   @observable pieBoxRatio = 0.20    // 柱状图高度比例   @observable barBoxRatio = 0.23    // “My Dashboard 我的仪表盘” 高度   @computed get TitleHeight() {     const ratio = 80 / this.baseBoxHeight     return this.boxHeight * ratio   }   // 运行card高度   @computed get todayCardHeight() {     const ratio = 75 / this.baseBoxHeight     return this.boxHeight * ratio   }    // “饼图+描述列表+柱状图” body 高度   @computed get statisticBodyHeight() {     const ratio = 660 / this.baseBoxHeight     return this.boxHeight * ratio   }    // 居住趋势 body 的高度   @computed get trendBodyBodyHeight() {     const ratio = 385 / this.baseBoxHeight     return this.boxHeight * ratio   }    // xys16 得用 computed 才会联动。下面这种写法不会联动   @computed get xys16() {     return (16 / this.baseBoxHeight) * this.boxHeight   }    // 饼状图盒子高度   @computed get pieBoxHeight() {     return this.pieBoxRatio * this.boxHeight   }     // card 的 header 比例   @computed get cardTitleStyle() {     const cardTitleRatio = 57 / this.baseBoxHeight     return { display: 'flex', height: this.boxHeight * cardTitleRatio, alignItems: 'center', justifyContent: 'center' }   } }</code></pre> <h3 id="问题">问题</h3> <p>实现过程中出现如下<strong>两个</strong>问题：一个是折线图的 Y 轴<code>乱序</code>，一个是堆叠柱状图有一节<code>空白</code>。<br /><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/4e4c8a8952605e0ca99aa3101c649546.jpg" alt="react实战系列 —— 我的仪表盘（bizcharts、antd、moment）_在线工具"></p> <p>原因是<strong>值</strong>不小心弄成了<code>字符串</code>，改为<code>数字</code>类型即可。</p> <blockquote> <p>其他章节请看：</p> <p>react实战 系列</p> </blockquote> 			
                        <div class="col-md-12 mt-5">
                                                        <p>上一个：<a href="/html/category/article-365.htm">spring集成mongodb及基础使用</a></p>
                                                        <p>下一个：<a href="/html/category/article-367.htm">为什么要使用TypeScript？TypeScript和js区别在何处？</a></p>
                                                    </div>

                                            </div>
                    <div class="col-md-3">
                        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/html/category/article-3757.htm" title="Python 图_系列之纵横对比  Bellman-Ford 和  Dijkstra 最短路径算法">Python 图_系列之纵横对比  Bellman-Ford 和  Dijkstra 最短路径算法</a></li>
                        <li class="py-2"><a href="/html/category/article-3758.htm" title="浅尝Spring注解开发_简单理解BeanFactoryPostProcessor、BeanDefinitionRegistryPostProcessor、ApplicationListener_在线工具">浅尝Spring注解开发_简单理解BeanFactoryPostProcessor、BeanDefinitionRegistryPostProcessor、ApplicationListener_在线工具</a></li>
                        <li class="py-2"><a href="/html/category/article-3732.htm" title="前端:一篇彻底搞懂vuex (mapState、mapGetters、mapMutations、mapActions)">前端:一篇彻底搞懂vuex (mapState、mapGetters、mapMutations、mapActions)</a></li>
                        <li class="py-2"><a href="/html/category/article-6000.htm" title="宠物粮批发怎么做赚钱（宠物粮批发怎么做赚钱快）">宠物粮批发怎么做赚钱（宠物粮批发怎么做赚钱快）</a></li>
                        <li class="py-2"><a href="/html/category/article-4480.htm" title="一岁的猫还用打猫三联吗（一岁的猫还打疫苗吗）">一岁的猫还用打猫三联吗（一岁的猫还打疫苗吗）</a></li>
                        <li class="py-2"><a href="/html/category/article-4069.htm" title="Rust如何开发eBPF应用">Rust如何开发eBPF应用</a></li>
                        <li class="py-2"><a href="/html/category/article-6194.htm" title="瑞鹏宠物医院什么时候上市（瑞鹏宠物医院创始人简历）">瑞鹏宠物医院什么时候上市（瑞鹏宠物医院创始人简历）</a></li>
                        <li class="py-2"><a href="/html/category/article-4404.htm" title="动物疫苗品牌排名前十 动物疫苗品牌排名前十名">动物疫苗品牌排名前十 动物疫苗品牌排名前十名</a></li>
                        <li class="py-2"><a href="/html/category/article-5572.htm" title="1970年农历四月二十七是几号 1970年农历四月二十七是几号出生">1970年农历四月二十七是几号 1970年农历四月二十七是几号出生</a></li>
                        <li class="py-2"><a href="/html/category/article-6106.htm" title="猫打疫苗总共多少钱（猫打疫苗多少钱一只啊）">猫打疫苗总共多少钱（猫打疫苗多少钱一只啊）</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">38</span> <a href="/html/date/2024-07/" title="2024-07 归档">2024-07</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-06/" title="2024-06 归档">2024-06</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-05/" title="2024-05 归档">2024-05</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-04/" title="2024-04 归档">2024-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-03/" title="2024-03 归档">2024-03</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">58</span> <a href="/html/date/2024-02/" title="2024-02 归档">2024-02</a></h4>
            </li>
                    </ul>
    </div>
</div>



                    </div>
                </div>
            
            </div>
        </div>
    </section>
    
        <section class="w3l-footer-29-main w3l-copyright">
        <div class="container">
            <div class="row bottom-copies">
                <p class="col-lg-8 copy-footer-29">
                    SwedenAddress 版权所有
                    <br />
                    Powered by WordPress
                </p>
                <div class="col-lg-4 main-social-footer-29">
                    <a href="#facebook" class="facebook"><span class="fa fa-facebook"></span></a>
                    <a href="#twitter" class="twitter"><span class="fa fa-twitter"></span></a>
                    <a href="#instagram" class="instagram"><span class="fa fa-instagram"></span></a>
                    <a href="#linkedin" class="linkedin"><span class="fa fa-linkedin"></span></a>
                </div>
            </div>
        </div>
    </section>
    <!-- move top -->
    <button onclick="topFunction()" id="movetop" title="Go to top">
        <span class="fa fa-long-arrow-up"></span>
    </button>
    <script>
    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function() {
        scrollFunction()
    };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("movetop").style.display = "block";
        } else {
            document.getElementById("movetop").style.display = "none";
        }
    }

    // When the user clicks on the button, scroll to the top of the document
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
    </script>
    <!-- /move top -->
    <script>
    $(function() {
        $('.js_to').click(function(){
            var url = $(this).data('url');
            var code = $(this).data('code');
            url += code;

            window.open(url);
        })
    });
    </script>
</body>

</html>